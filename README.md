
I wrote this with GPT and repeated trial and error.  Then I used:

https://chromium.googlesource.com/apps/libapps/+/HEAD/ssh_client/echosshd/echosshd.cc